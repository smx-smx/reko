<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFramework>netstandard2.1</TargetFramework>
    <GenerateAssemblyInfo>false</GenerateAssemblyInfo>
    <AssemblyName>Reko.Environments.OS2</AssemblyName>
    <RootNamespace>Reko.Environments.OS2</RootNamespace>
    <Configurations>Debug;Release</Configurations>
  </PropertyGroup>

  <ItemGroup>
    <ProjectReference Include="..\..\Arch\X86\X86.csproj" />
    <ProjectReference Include="..\..\Core\Core.csproj" />
  </ItemGroup>
  
  <ItemGroup>
    <TranslateHeader Include="os2-16.inc" />
    <TranslateHeader Include="16/fsu.inc" />
    <TranslateHeader Include="16/fsh.inc" />
    <TranslateHeader Include="16/fsd.inc" /> 
  </ItemGroup>

  <Target Name="RunC2Xml" AfterTargets="CoreBuild">
    <Msbuild Projects="$(ProjectDir)..\..\tools\c2xml\C2Xml.csproj" RemoveProperties="TargetFramework" />
    <Copy SkipUnchangedFiles="true" SourceFiles="$(ProjectDir)bin\$(Configuration)\netstandard2.1\Reko.Environments.OS2.dll" DestinationFolder="$(ProjectDir)..\..\tools" />
    <Copy SkipUnchangedFiles="true" SourceFiles="$(ProjectDir)..\..\Arch\X86\bin\$(Configuration)\netstandard2.1\Reko.Arch.X86.dll" DestinationFolder="$(ProjectDir)..\..\tools" />
    <Exec Condition=" '$(OS)' == 'Unix' " Command="dotnet &quot;$(ProjectDir)../../tools/c2xml.dll&quot; -a x86-protected-32 -e os2-16 -d msvc %(TranslateHeader.Identity) %(TranslateHeader.Filename).xml" />
    <Exec Condition=" '$(OS)' != 'Unix' " Command="&quot;$(ProjectDir)..\..\tools\c2xml.exe&quot; -a x86-protected-32 -e os2-16 -d msvc %(TranslateHeader.Identity) %(TranslateHeader.Filename).xml" />
  </Target>
</Project>
